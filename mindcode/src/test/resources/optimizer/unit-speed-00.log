    95 instructions before optimizations.
     4 instructions eliminated by OutputTempEliminator.
     1 instructions eliminated by ExpressionOptimizer.
     6 instructions eliminated by ImproveNegativeConditionalJumps.
     6 loops improved by LoopOptimizer.
     5 instructions added by LoopOptimizer.
     3 instructions eliminated by PrintMerger.
    86 instructions after optimizations.

Modifications by OutputTempEliminator, iteration 1:
 
     1 set SX 10
     2 set SY 10
     3 set DX 10
-    * op sub __tmp0 @maph 10
-    * set DY __tmp0
+    4 op sub DY @maph 10
     5 op sub __tmp1 DX SX
     6 op sub __tmp2 DY SY
     7 op len __tmp3 __tmp1 __tmp2
 
     9 op add __tmp5 __tmp4 0.5
    10 op floor __tmp6 __tmp5
    11 op div __tmp7 __tmp6 100
-    * op sub __tmp8 __tmp7 2
-    * set distance __tmp8
+   12 op sub distance __tmp7 2
    13 ubind UNIT
    14 label __label0
    15 op equal __tmp9 @unit null
 
    76 op div __tmp23 __tmp22 2
    77 ucontrol move __tmp20 __tmp23
    78 ucontrol flag 0
-    * op sub __tmp24 finish start
-    * set elapsed __tmp24
+   79 op sub elapsed finish start
    80 op div __tmp25 distance elapsed
    81 op mul __tmp26 __tmp25 100000
    82 op floor __tmp27 __tmp26
-    * op div __tmp28 __tmp27 100
-    * set speed __tmp28
+   83 op div speed __tmp27 100
    84 label __label15
    85 sensor __tmp29 switch1 @enabled
    86 op equal __tmp30 __tmp29 false

Modifications by ExpressionOptimizer, iteration 1:
 
    78 ucontrol flag 0
    79 op sub elapsed finish start
    80 op div __tmp25 distance elapsed
-    * op mul __tmp26 __tmp25 100000
-    * op floor __tmp27 __tmp26
+   81 op idiv __tmp27 __tmp25 0.00001
    82 op div speed __tmp27 100
    83 label __label15
    84 sensor __tmp29 switch1 @enabled

Modifications by ImproveNegativeConditionalJumps, iteration 1:
 
    12 op sub distance __tmp7 2
    13 ubind UNIT
    14 label __label0
-    * op equal __tmp9 @unit null
-    * jump __label2 equal __tmp9 false
+   15 jump __label2 notEqual @unit null
    16 print UNIT
    17 print ": no active unit found."
    18 printflush message1
 
    22 label __label2
    23 label __label3
    24 sensor __tmp10 switch1 @enabled
-    * op equal __tmp11 __tmp10 false
-    * jump __label5 equal __tmp11 false
+   25 jump __label5 notEqual __tmp10 false
    26 print "Press button to start measuring "
    27 print UNIT
    28 print " speed."
 
    33 control enabled switch1 false
    34 label __label6
    35 sensor __tmp12 @unit @controlled
-    * op notEqual __tmp13 __tmp12 0
-    * jump __label8 equal __tmp13 false
+   36 jump __label8 equal __tmp12 0
    37 print "Searching free "
    38 print UNIT
    39 printflush message1
 
    44 ucontrol flag 1
    45 label __label9
    46 ucontrol within SX SY 1 __tmp14
-    * op equal __tmp15 __tmp14 false
-    * jump __label11 equal __tmp15 false
+   47 jump __label11 notEqual __tmp14 false
    48 print "Moving to start"
    49 printflush message1
    50 ucontrol move SX SY
 
    57 ucontrol move DX DY
    58 label __label12
    59 ucontrol within DX DY 1 __tmp16
-    * op equal __tmp17 __tmp16 false
-    * jump __label14 equal __tmp17 false
+   60 jump __label14 notEqual __tmp16 false
    61 ucontrol move DX DY
    62 label __label13
    63 jump __label12 always
 
    77 op div speed __tmp27 100
    78 label __label15
    79 sensor __tmp29 switch1 @enabled
-    * op equal __tmp30 __tmp29 false
-    * jump __label17 equal __tmp30 false
+   80 jump __label17 notEqual __tmp29 false
    81 print "Measurement results ("
    82 print UNIT
    83 print "):"

Modifications by LoopOptimizer, iteration 1:
 
    13 ubind UNIT
    14 label __label0
    15 jump __label2 notEqual @unit null
+   16 label __label18
    17 print UNIT
    18 print ": no active unit found."
    19 printflush message1
    20 ubind UNIT
    21 label __label1
-    * jump __label0 always
+   22 jump __label18 equal @unit null
    23 label __label2
    24 label __label3
    25 sensor __tmp10 switch1 @enabled
    26 jump __label5 notEqual __tmp10 false
+   27 label __label19
    28 print "Press button to start measuring "
    29 print UNIT
    30 print " speed."
    31 printflush message1
    32 label __label4
-    * jump __label3 always
+   33 sensor __tmp10 switch1 @enabled
+   34 jump __label19 equal __tmp10 false
    35 label __label5
    36 control enabled switch1 false
    37 label __label6
    38 sensor __tmp12 @unit @controlled
    39 jump __label8 equal __tmp12 0
+   40 label __label20
    41 print "Searching free "
    42 print UNIT
    43 printflush message1
    44 ubind UNIT
    45 label __label7
-    * jump __label6 always
+   46 sensor __tmp12 @unit @controlled
+   47 jump __label20 notEqual __tmp12 0
    48 label __label8
    49 ucontrol flag 1
    50 label __label9
    51 ucontrol within SX SY 1 __tmp14
    52 jump __label11 notEqual __tmp14 false
+   53 label __label21
    54 print "Moving to start"
    55 printflush message1
    56 ucontrol move SX SY
    57 label __label10
-    * jump __label9 always
+   58 ucontrol within SX SY 1 __tmp14
+   59 jump __label21 equal __tmp14 false
    60 label __label11
    61 print "Moving to destination"
    62 printflush message1
 
    65 label __label12
    66 ucontrol within DX DY 1 __tmp16
    67 jump __label14 notEqual __tmp16 false
+   68 label __label22
    69 ucontrol move DX DY
    70 label __label13
-    * jump __label12 always
+   71 ucontrol within DX DY 1 __tmp16
+   72 jump __label22 equal __tmp16 false
    73 label __label14
    74 set finish @time
    75 op sub __tmp18 SX DX
 
    87 label __label15
    88 sensor __tmp29 switch1 @enabled
    89 jump __label17 notEqual __tmp29 false
+   90 label __label23
    91 print "Measurement results ("
    92 print UNIT
    93 print "):"
 
   106 print "\nPress button to repeat"
   107 printflush message1
   108 label __label16
-    * jump __label15 always
+  109 sensor __tmp29 switch1 @enabled
+  110 jump __label23 equal __tmp29 false
   111 label __label17
   112 end

Modifications by PrintMerger, iteration 1:
 
    90 label __label23
    91 print "Measurement results ("
    92 print UNIT
-    * print "):"
-    * print "\nMap dimensions: "
+   93 print "):\nMap dimensions: "
    94 print @mapw
    95 print "x"
    96 print @maph
    97 print "\nElapsed time: "
    98 print elapsed
-    * print "ms"
-    * print "\nDistance travelled: "
+   99 print "ms\nDistance travelled: "
   100 print distance
   101 print "\nSpeed: "
   102 print speed
-    * print "tiles/s"
-    * print "\nPress button to repeat"
+  103 print "tiles/s\nPress button to repeat"
   104 printflush message1
   105 label __label16
   106 sensor __tmp29 switch1 @enabled

Final code before resolving virtual instructions:

set UNIT @flare
set SX 10
set SY 10
set DX 10
op sub DY @maph 10
op sub __tmp1 DX SX
op sub __tmp2 DY SY
op len __tmp3 __tmp1 __tmp2
op mul __tmp4 100 __tmp3
op add __tmp5 __tmp4 0.5
op floor __tmp6 __tmp5 0
op div __tmp7 __tmp6 100
op sub distance __tmp7 2
ubind UNIT
label __label0
jump __label2 notEqual @unit null
label __label18
print UNIT
print ": no active unit found."
printflush message1
ubind UNIT
label __label1
jump __label18 equal @unit null
label __label2
label __label3
sensor __tmp10 switch1 @enabled
jump __label5 notEqual __tmp10 false
label __label19
print "Press button to start measuring "
print UNIT
print " speed."
printflush message1
label __label4
sensor __tmp10 switch1 @enabled
jump __label19 equal __tmp10 false
label __label5
control enabled switch1 false 0 0 0
label __label6
sensor __tmp12 @unit @controlled
jump __label8 equal __tmp12 0
label __label20
print "Searching free "
print UNIT
printflush message1
ubind UNIT
label __label7
sensor __tmp12 @unit @controlled
jump __label20 notEqual __tmp12 0
label __label8
ucontrol flag 1 0 0 0 0
label __label9
ucontrol within SX SY 1 __tmp14 0
jump __label11 notEqual __tmp14 false
label __label21
print "Moving to start"
printflush message1
ucontrol move SX SY 0 0 0
label __label10
ucontrol within SX SY 1 __tmp14 0
jump __label21 equal __tmp14 false
label __label11
print "Moving to destination"
printflush message1
set start @time
ucontrol move DX DY 0 0 0
label __label12
ucontrol within DX DY 1 __tmp16 0
jump __label14 notEqual __tmp16 false
label __label22
ucontrol move DX DY 0 0 0
label __label13
ucontrol within DX DY 1 __tmp16 0
jump __label22 equal __tmp16 false
label __label14
set finish @time
op sub __tmp18 SX DX
op abs __tmp19 __tmp18 0
op div __tmp20 __tmp19 2
op sub __tmp21 SY DY
op abs __tmp22 __tmp21 0
op div __tmp23 __tmp22 2
ucontrol move __tmp20 __tmp23 0 0 0
ucontrol flag 0 0 0 0 0
op sub elapsed finish start
op div __tmp25 distance elapsed
op idiv __tmp27 __tmp25 0.00001
op div speed __tmp27 100
label __label15
sensor __tmp29 switch1 @enabled
jump __label17 notEqual __tmp29 false
label __label23
print "Measurement results ("
print UNIT
print "):\nMap dimensions: "
print @mapw
print "x"
print @maph
print "\nElapsed time: "
print elapsed
print "ms\nDistance travelled: "
print distance
print "\nSpeed: "
print speed
print "tiles/s\nPress button to repeat"
printflush message1
label __label16
sensor __tmp29 switch1 @enabled
jump __label23 equal __tmp29 false
label __label17
end
